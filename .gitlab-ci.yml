
stages:
    - build
    - test
    - staging
    - production
    
 

build:
    image: maven:3-jdk-11
    stage: build
    script:
        - mvn -f demo/pom.xml compile
    tags:
        - ugrad    
    #artifacts:
    # paths:
    #     - target/*.jar


test:
    image: maven:3-jdk-11
    stage: test
    script:
        - mvn -f demo/pom.xml test
    artifacts:
    when: always
    tags:
        - ugrad
    # reports:
    #     junit:
    #         - target/surefire-reports/TEST-*.xml
    #         - target/failsafe-reports/TEST-*.xml

staging:
    image: ruby:latest
    type: deploy
    stage: staging
    tags:
        - ugrad
    before_script:
        - chmod -R 777 /var/lib/apt/lists
        - apt-get update -qy
        - apt-get install -y ruby-dev
        - gem install dpl
    script:
        - dpl --provider=heroku --app=$HEROKU_STAGING_APP_NAME --api-key=$HEROKU_API_KEY
    only:
        - develop


production:
    image: ruby:latest
    type: deploy
    stage: production
    tags:
        - ugrad
    before_script:
        - chmod -R 777 /var/lib/apt/lists
        - apt-get update -qy
        - apt-get install -y ruby-dev
        - gem install dpl
    script:
        - dpl --provider=heroku --app=$HEROKU_PROD_APP_NAME --api-key=$HEROKU_API_KEY
    only:
        - main
